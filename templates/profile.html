{% extends 'base.html' %}
{% load static %}

<!-- {% block extra_css %}
<style>
    html, body {
        background-color: #EFA8B8 !important; 
    }
</style>
  {% endblock %} -->
{%block extra_head%}
  <style>
    html, body {
        background-color: #EFA8B8 !important; 
    }
    </style>
    
    <!-- <link href=
    "https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" 
              rel="stylesheet" 
              integrity=
    "sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
              crossorigin="anonymous">
        <script src=
    "https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" 
              integrity=
    "sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
              crossorigin="anonymous">
        </script>
        <style>
            form:focus-within {
              background: green;
            }
        </style> -->
  {%endblock%}
{% block content %}
  <br>
  <br>
  <br>
  <br>

    <div class="container">
      <!-- working area -->
      <div class="row">
        <div class="col">
          <div class="profile shadow-lg " style="width: 800px">                   
            <p class="text-center"> welcome back {{ request.user.username }} </p>
          </div>            
        </div>
      </div>
      <br>
      <br>
      <br>
      <div class="row">
        <div class="col">
          <!-- <div class="profile p-4" style="max-width: 400px; width: 100%; border-radius: 15px;">  -->
          <div class="profile_text">                    
              <p class="profile_text" style="width: 800px; height: 50px; color: #3e2a35; font-family: 'Lexend Zetta', sans-serif;  font-size: 40px; "> start today's prompt:</p>
              <br>
              <p class="text-left"style="width: 1000px; height: 100px; color: #ffffff; font-family: 'Lexend Zetta', sans-serif;  font-size: 40px; "><strong>{{ prompt_text }}</strong></p> 
            </div>
        </div>
      </div>



      {% if not prior_entry%}
        <div class="row">
          <div class="col">
              <div class="journal_entry shadow-lg p-4" style="background-color: #72e1d1; max-width: 800px; width: 100%; border-radius: 15px;">
                  <!-- <form method="POST" action="{% url 'save_entry'}"> -->
                  <form method="POST" action="{% url 'airtalesapp:save_entry' %}">
                    <!-- <form method="POST" action="{% url 'airtalesapp:save_entry' %}"> -->
                      {% csrf_token %}
                      <!-- Text Field -->
                      <div class="mb-3"style="background-color: #72e1d1;font-family: 'Lexend Zetta', sans-serif;">
                          <label for="exampleFormControlTextarea1" class="form-label">tell us everything...</label>
                          <textarea class="form-control" id="exampleFormControlTextarea1" name = "entry_text" rows="3" ></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                        <!-- <button type="submit" class="nav-link btn btn-outline-primary me-2">Submit</button> -->

                  </form>
                </div>

          </div>
        </div> 
        {%else%}
        <p class="profile_text" style="width: 800px; height: 50px; color: #3e2a35; font-family: 'Lexend Zetta', sans-serif;  font-size: 40px; "> journal entry submitted for today</p>
        {%endif%}
    
    <div>

  <br>
  <br>
  <br>
  <br>
  <br>
    <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            {% for entry in journal_entries %}
              <div class="carousel-item {% if forloop.first %}active{% endif %}">
                  <div class="d-flex justify-content-center">

                      <!-- <a href="{% url 'airtalesapp:view_entry' entry.id %}" class="bubble text-center"> -->
                          <!-- {{ entry.date }} -->
                    <button class="btn btn-outline-dark entry-btn" data-entry-id="entry-{{ entry.id }}">
                      {{ entry.date }} <!-- Display the journal entry date -->
                    </button>
                          <!-- {{ entry.entry|truncatewords:10 }}  -->
                  </div>
                </div>

                {% empty %}
                  <div class="carousel-item active">
                      <p class="text-center">No journal entries available.</p>
                    </div>
              {% endfor %}
          </div>

        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
      </div>




 <!-- testing area -->

    <div id="journalEntryDisplay" class="mt-4 text-center" style="display: none;">
        <h3><span id="entryDate"></span></h3>
        <!-- <h5>Prompt: <span id="entryPrompt"></span></h5> -->
        <p id="entryText"></p>
      </div>
  
      <!-- Hidden Entries (to be revealed when clicked) -->
    {% for entry in journal_entries %}
      <div id="entry-{{ entry.id }}" class="hidden-entry" style="display: none;">
          <span class="entry-date">{{ entry.date }}</span>
          <!-- <span class="entry-date">{{ entry.date }}</span> -->
          <!-- <span class="entry-prompt">{{ entry.date.prompt }}</span>  -->
          <span class="entry-text">{{ entry.entry }}</span>
            <!-- 
                  {% with prompt_for_date=prompts_dict|default_if_none:entry.date %}
                  <span class="entry-prompt">
                      {% if prompt_for_date %}{{ prompts_dict|default_if_none:entry.date }}{% else %}No prompt available{% endif %}
                  </span>
                    {% endwith %} -->
          <!-- <span class="entry-prompt">
            {% if prompts_previous and entry.date in prompts_previous %}
                {{ prompts_previous[entry.date] }}
            {% else %}
                No prompt available
            {% endif %}
            </span> -->
            <!-- <span class="entry-prompt">
              {% for prompt in prompts_previous %}
                {% if prompt.date == entry.date %}
                  {{ prompt.prompt }}
                {% endif %}
              {% endfor %}
              {% if not prompt %}
                No prompt available
              {% endif %}
            </span> -->
        </div>
      {% endfor %}
  
  <!-- JavaScript to Handle Showing Entries -->
      <script>


          document.querySelectorAll('.entry-btn').forEach(button => {
              button.addEventListener('click', function() {
                let entryId = this.getAttribute('data-entry-id');
                // console.log("Debugging message");
                let entryElement = document.getElementById(entryId);

                  if (entryElement) {
                      let dateText = entryElement.querySelector('.entry-date')?.textContent || 'No date available';
                      let entryText = entryElement.querySelector('.entry-text')?.textContent || 'No entry available';
                      // let promptText = entryElement.querySelector('.entry-prompt')?.textContent || 'No prompt available';

                      document.getElementById('entryDate').textContent = dateText;
                      document.getElementById('entryText').textContent = entryText;
                      // document.getElementById('entryPrompt').textContent = promptText;
                      document.getElementById('journalEntryDisplay').style.display = 'block';
                    }
              });
            });


        </script>


    <!-- <div>

  </div> -->
  {% endblock %}
<!-- 
      // document.querySelectorAll('.entry-btn').forEach(button => {
      //     button.addEventListener('click', function() {
      //         let entryId = this.getAttribute('data-entry-id');
      //         let entryElement = document.getElementById(entryId);
  
      //         if (entryElement) {
      //             document.getElementById('entryDate').textContent = entryElement.querySelector('.entry-date').textContent;
      //             document.getElementById('entryText').textContent = entryElement.querySelector('.entry-text').textContent;
      //             document.getElementById('entryPrompt').textContent = entryElement.querySelector('.entry-prompt').textContent;
      //             document.getElementById('journalEntryDisplay').style.display = 'block';
      //         }
      //     });
      // }); -->




